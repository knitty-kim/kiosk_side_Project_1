<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .line-through {
      text-decoration: line-through;
    }
  </style>
  <script>
    function redirectionHome() {
      window.location.href = '/';
    }

    //담기 버튼, 유효성 검사
    function toCart() {

      let itemId = '[[${item.id}]]';
      let qtyId = 'inputCnt' + itemId;
      let price = '[[${item.price}]]';
      // countCheck(qtyId);

      // if ($('input.is-invalid').length > 0) {
      //   alert("check invalid value!");
      //   return false;
      // }


      let data = {
        teamId : $("#sessionId").val(),
        itemId : itemId,
        price : price,
        qty : $("#" + qtyId).val()
      }

      $.ajax({
        url: '/carts/add',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(data),
        success: function(response) {

          $("#" + qtyId).val('');     //담은 수량 초기화

          if (response[0] == true) {
            if (confirm("담기 성공! 장바구니로 이동하시겠습니까?")) {
              location.href = "/cart-list";
            }
          } else {
            alert(response[1]);
          }

        },
        error: function(error) {
          console.error('Error sending data', error);


        }
      });
    }
  </script>
</head>
<body>
<input type="hidden" id="sessionId" th:value="${session.id}">
<div class="container my-5">
  <div class="row">
    <!-- 상품 이미지 -->
    <div class="col-md-6">
      <img th:if="${item.getImg1()}" th:src="|/images/${item.getImg1()}|" class="img-fluid" alt="상품 이미지 1">
      <img th:unless="${item.getImg1()}" src="https://via.placeholder.com/500" alt="상품 이미지" class="img-fluid">
    </div>

    <!-- 상품 정보 -->
    <div class="col-md-6">
      <!-- 상품명 -->
      <h2 class="mb-3" th:text="*{item.name}">상품명 예시</h2>
      <!-- 판매자 -->
      <p class="text-muted" th:utext="'<strong>판매자 :</strong> ' + ${item.seller.name}">Master</p>
      <!-- 가격 -->
      <h4 class="text-danger"
          th:classappend="${item.status.toString() == 'CLOSED'} ? 'line-through' : ''"
          th:utext="'$ ' + ${item.price}">$ 49,900</h4>
      <!-- 상태 -->
      <h4 class="text-danger" th:if="${item.status.toString() == 'CLOSED'}" th:text="${item.status}">OPEN/CLOSED</h4>
      <p class="mt-3" th:if="${item.status.toString() == 'CLOSED'}">
        THIS FOOD IS NOT AVAILABLE FOR A MOMENT...
      </p>
      <p class="mt-3" th:if="${item.status.toString() != 'CLOSED'}">
        This food is made with the highest quality ingredients,
        delivering both great taste and a touch of happiness.<br>
        ORDER now and ENJOY a special experience like no other!
      </p>

      <!-- 재고 및 수량 -->
      <div class="d-flex align-items-center mt-4 mb-3" th:if="${item.status.toString() == 'OPEN'}">
        <!-- 재고 -->
        <label for="stock" class="form-label me-3">재고</label>
        <input type="number" id="stock" class="form-control w-25 me-3" disabled th:value="${item.qty}">
        <!-- 수량 선택 -->
        <label for="quantity" class="form-label me-3">수량</label>
        <input type="number" id="quantity" class="form-control w-25" value="1" min="1"
               th:id="inputCnt+${item.id}">
      </div>

      <!-- 구매 버튼 -->
      <!--<button class="btn btn-primary btn-lg">구매하기</button>-->

      <!-- 장바구니 담기 버튼 -->
      <div class="d-flex"
           th:if="${item.status.toString() == 'OPEN'}
           and ${session.types == 'master' or session.types == 'team'}">
        <button class="btn btn-primary btn-lg" type="button"
                onclick="toCart()">장바구니 담기</button>
      </div>

    </div>

    <div class="d-flex justify-content-end mt-5">
      <button th:if="${session.types == 'master'}"
              class="btn btn-secondary btn-lg me-2"
              th:onclick="|location.href='@{/item/update/{itemId}(itemId=${item.id})}'|"
              type="button">수정</button>
      <button class="btn btn-primary btn-lg me-2"
              onclick="redirectionHome()"
              type="button">홈</button>
      <button class="btn btn-primary btn-lg"
              th:onclick="|location.href='@{/item-list}'|"
              type="button">상품 목록</button>
    </div>

  </div>

  <!-- 상세 탭 -->
  <div class="row">
    <div class="col-12">
      <!-- 상세 네비게이션 -->
      <ul class="nav nav-tabs" id="productDetailsTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="description-tab"
                  data-bs-toggle="tab" data-bs-target="#description"
                  type="button" role="tab" aria-controls="description"
                  aria-selected="true">상세 설명</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="reviews-tab"
                  data-bs-toggle="tab" data-bs-target="#reviews"
                  type="button" role="tab" aria-controls="reviews"
                  aria-selected="false">상품 리뷰</button>
        </li>
      </ul>
      <!--네비게이션 끝-->

      <!-- 상세 내용 -->
      <div class="tab-content" id="productDetailsTabContent">

        <!-- 상품 설명 -->
        <div class="tab-pane fade show active p-4" id="description" role="tabpanel" aria-labelledby="description-tab">
          <!--<h5>상품 설명</h5>
          <p>
            이 상품은 편안한 착용감과 스타일을 동시에 만족시키기 위해 최상의 재료로 제작되었습니다.
            다양한 색상과 사이즈로 제공되며, 패셔너블하면서도 실용적인 디자인이 특징입니다.
          </p>-->

          <!-- 이미지2 ~ 6 (수직 정렬 및 가운데 정렬) -->
          <div class="d-flex flex-column align-items-center">
<!--            <div class="mb-3">-->
<!--              <img th:src="@{${img1}}" class="img-fluid" alt="상품 이미지 1" style="max-width: 100%; height: auto;">-->
<!--            </div>-->
            <div class="mb-3">
              <img class="img-fluid" alt="상품 이미지 2" style="max-width: 100%; height: auto;"
                   th:if="${item.getImg2()}" th:src="|/images/${item.getImg2()}|">
              <img class="img-fluid" alt="상품 이미지 2" style="max-width: 100%; height: auto;"
                   th:unless="${item.getImg2()}" src="https://via.placeholder.com/500">
            </div>
            <div class="mb-3">
              <img class="img-fluid" alt="상품 이미지 3" style="max-width: 100%; height: auto;"
                   th:if="${item.getImg3()}" th:src="|/images/${item.getImg3()}|">
              <img class="img-fluid" alt="상품 이미지 3" style="max-width: 100%; height: auto;"
                   th:unless="${item.getImg3()}" src="https://via.placeholder.com/500">
            </div>
            <div class="mb-3">
              <img class="img-fluid" alt="상품 이미지 4" style="max-width: 100%; height: auto;"
                   th:if="${item.getImg4()}" th:src="|/images/${item.getImg4()}|">
            </div>
            <div class="mb-3">
              <img class="img-fluid" alt="상품 이미지 5" style="max-width: 100%; height: auto;"
                   th:if="${item.getImg5()}" th:src="|/images/${item.getImg5()}|">
            </div>
            <div class="mb-3">
              <img class="img-fluid" alt="상품 이미지 6" style="max-width: 100%; height: auto;"
                   th:if="${item.getImg6()}" th:src="|/images/${item.getImg6()}|">
            </div>
          </div>
        </div>

        <!-- 상품 리뷰 -->
        <div class="tab-pane fade p-4" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
          <h5>상품 리뷰</h5>
          <div class="review">
            <strong>User1:</strong>
            <p>This is food you can trust! It's delicious and packed with great nutrition.</p>
          </div>
          <div class="review">
            <strong>User2:</strong>
            <p>Perfectly sized for anytime, anywhere, and guaranteed to taste amazing!</p>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
<script src="http://code.jquery.com/jquery-latest.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
